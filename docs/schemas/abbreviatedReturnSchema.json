{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "agentDetails": {
      "type": "object",
      "properties": {
        "agentActingOnBehalfOfCompany": {
          "type": "boolean"
        },
        "agentName": {
          "$ref": "definitions.json#/definitions/agentName"
        }
      },
      "required": [
        "agentActingOnBehalfOfCompany"
      ],
      "additionalProperties": false
    },
    "isReportingCompanyUltimateParent": {
      "type": "boolean"
    },
    "parentCompany": {
      "type": "object",
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "ultimateParent": {
              "type": "object",
              "oneOf": [
                {
                  "properties": {
                    "registeredCompanyName": {
                      "$ref": "definitions.json#/definitions/companyName"
                    },
                    "knownAs": {
                      "$ref": "definitions.json#/definitions/companyName"
                    },
                    "utr": {
                      "$ref": "definitions.json#/definitions/utr"
                    },
                    "crn": {
                      "$ref": "definitions.json#/definitions/crn"
                    },
                    "otherUkTaxReference": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "registeredCompanyName",
                    "utr",
                    "crn"
                  ]
                },
                {
                  "properties": {
                    "registeredCompanyName": {
                      "$ref": "definitions.json#/definitions/companyNameNonUk"
                    },
                    "knownAs": {
                      "$ref": "definitions.json#/definitions/companyNameNonUk"
                    },
                    "countryOfIncorporation": {
                      "$ref": "countrycodes.json#/definitions/countryCode"
                    },
                    "crn": {
                      "$ref": "definitions.json#/definitions/crnNonUk"
                    }
                  },
                  "required": [
                    "registeredCompanyName",
                    "crn",
                    "countryOfIncorporation"
                  ]
                }
              ]
            }
          },
          "required": [
            "ultimateParent"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "deemedParent": {
              "type": "array",
              "minItems": 1,
              "maxItems": 3,
              "items": {
                "type": "object",
                "properties": {
                  "companyName": {
                    "$ref": "definitions.json#/definitions/companyNameNonUk"
                  },
                  "utr": {
                    "$ref": "definitions.json#/definitions/utr"
                  }
                },
                "required": [
                  "companyName"
                ],
                "additionalProperties": false
              }
            }
          },
          "required": [
            "deemedParent"
          ],
          "additionalProperties": false
        }
      ]
    },
    "groupCompanyDetails": {
      "properties": {
        "totalCompanies": {
          "type": "integer",
          "minimum": 1
        },
        "inclusionOfNonConsentingCompanies": {
          "type": "boolean"
        },
        "accountingPeriod": {
          "properties": {
            "startDate": {
              "type": "string",
              "format": "date"
            },
            "endDate": {
              "type": "string",
              "format": "date"
            }
          },
          "required": [
            "startDate",
            "endDate"
          ]
        }
      },
      "required": [
        "totalCompanies",
        "inclusionOfNonConsentingCompanies",
        "accountingPeriod"
      ],
      "additionalProperties": false
    },
    "submissionType": {
      "type": "string",
      "enum": [
        "original",
        "revised"
      ]
    },
    "revisedReturnDetails": {
      "type": "string",
      "minLength": 1
    },
    "ukCompanies": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "companyName": {
            "$ref": "definitions.json#/definitions/companyName"
          },
          "utr": {
            "$ref": "definitions.json#/definitions/utr"
          }
        },
        "required": [
          "companyName",
          "utr"
        ],
        "additionalProperties": false
      }
    },
    "groupLevelElections": {
      "type": "object",
      "properties": {
        "groupRatioElection": {
          "$ref": "definitions.json#/definitions/election"
        },
        "groupRatioBlended": {
          "type": "object",
          "properties": {
            "election": {
              "$ref": "definitions.json#/definitions/election"
            },
            "investorGroups": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "properties": {
                  "groupName": {
                    "type": "string",
                    "minLength": 1
                  }
                },
                "required": [
                  "groupName"
                ]
              }
            }
          },
          "additionalProperties": false
        },
        "groupEBITDAChargeableGains": {
          "type": "boolean"
        },
        "interestAllowanceAlternativeCalculation": {
          "type": "boolean"
        },
        "interestAllowanceNonConsolidatedInvestment": {
          "type": "object",
          "properties": {
            "election": {
              "$ref": "definitions.json#/definitions/election"
            },
            "nonConsolidatedInvestments": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "properties": {
                  "investmentName": {
                    "type": "string",
                    "minLength": 1
                  }
                },
                "required": [
                  "investmentName"
                ]
              }
            }
          },
          "additionalProperties": false
        },
        "interestAllowanceConsolidatedPartnership": {
          "type": "object",
          "properties": {
            "election": {
              "$ref": "definitions.json#/definitions/election"
            },
            "consolidatedPartnerships": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "properties": {
                  "partnershipName": {
                    "type": "string",
                    "minLength": 1
                  }
                },
                "required": [
                  "partnershipName"
                ]
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "required": [
    "agentDetails",
    "isReportingCompanyUltimateParent",
    "parentCompany",
    "groupCompanyDetails",
    "submissionType",
    "ukCompanies"
  ],
  "additionalProperties": false
}